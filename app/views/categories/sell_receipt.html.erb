<h1>販売カテゴリ別の集計</h1>
<%= @start_date %>～<%= @end_date %>
<%= @category.category %>の集計

<table class="table-bordered">
  <thead>
    <tr>
      <th>日付</th>
      <th>商品名</th>
      <th>数量</th>
      <th>単位</th>
      <th>金額</th>
    </tr>
  </thead>
  <tbody>
    <% @sell_receipts.each do |sell_receipt| %>
      <% sell_receipt.sell_items.each do |sell_item| %>
        <% if sell_item.item.category_id == @category_id.to_i %>
          <tr>
            <td><%= sell_receipt.transaction_date %></td>
            <td><%= sell_item.item.item_name %></td>
            <td><%= sell_item.quantity %></td>
            <td><%= sell_item.item.unit %></td>
            <td><%= sell_item.item_price %></td>
          </tr>
        <% end %>
      <% end %>
    <% end %>
  </tbody>
  <tfoot>
    <tr>
      <td>合計</td>
      <td></td>
      <td></td>
      <td></td>
      <td>
        <%= @sell_receipts.joins(:sell_items)
                .joins("INNER JOIN items ON sell_items.item_id = items.id")
                .where(items: { category_id: @category_id })
                .sum('sell_items.item_price') %>
      </td>
    </tr>
  </tfoot>
</table>